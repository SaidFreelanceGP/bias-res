var option_trial_Data = [
    { id: 1, Option1_PPT:   80 ,   Option1_Partner: 70   ,  Type1:    "Prosocial",   Option2_PPT:  100  ,    Option2_Partner:  80  ,  Type2:   "Individual" },
    { id: 2, Option1_PPT:   70 ,   Option1_Partner: 60   ,  Type1:    "Prosocial",   Option2_PPT:   90  ,    Option2_Partner:  70  ,  Type2:   "Individual" },
    { id: 3,  Option1_PPT:  80  ,   Option1_Partner:   80 ,  Type1:   "Prosocial" ,  Option2_PPT:  90 ,   Option2_Partner:  60 ,  Type2: "Individual"   },
    { id: 4,  Option1_PPT:  90  ,   Option1_Partner:   80 ,  Type1:   "Prosocial" ,  Option2_PPT:  100 ,   Option2_Partner:  70 ,  Type2: "Individual"   },
    { id: 5,  Option1_PPT:  100 ,   Option1_Partner:   90 ,  Type1:   "Prosocial" ,  Option2_PPT:  110 ,   Option2_Partner:  80 ,  Type2: "Individual"  },
    { id: 6,  Option1_PPT:  100 ,   Option1_Partner:  100 ,  Type1:   "Prosocial" ,  Option2_PPT:  120 ,   Option2_Partner:  100 ,  Type2: "Individual"  },
    { id: 7,  Option1_PPT:   60 ,   Option1_Partner:   60 ,  Type1:   "Prosocial" ,  Option2_PPT:  80 ,   Option2_Partner:  50 ,  Type2: "Individual"   },
    { id: 8,  Option1_PPT:   80 ,   Option1_Partner:  70 ,  Type1:   "Prosocial" ,  Option2_PPT:  90 ,   Option2_Partner:  60 ,  Type2: "Individual"   },
    { id: 9,  Option1_PPT:   90 ,   Option1_Partner:  80 ,  Type1:   "Prosocial" ,  Option2_PPT:  100 ,   Option2_Partner:  70 ,  Type2: "Individual"  },
    { id: 10, Option1_PPT:  100 ,   Option1_Partner: 90   ,  Type1:    "Prosocial",   Option2_PPT:  110  ,    Option2_Partner:  80  ,  Type2:   "Individual" },
    { id: 11, Option1_PPT:   90 ,   Option1_Partner:  90 ,  Type1:   "Prosocial" ,  Option2_PPT:  100 ,   Option2_Partner:  80 ,  Type2: "Individual"  },
    { id: 12, Option1_PPT:  110 ,   Option1_Partner:  100 ,  Type1:   "Prosocial" ,  Option2_PPT: 120 ,   Option2_Partner:  90 ,  Type2: "Individual"   },
    { id: 13, Option1_PPT:  70,    Option1_Partner: 60   ,  Type1:    "Prosocial",   Option2_PPT:   80  ,    Option2_Partner:  50  ,  Type2:   "Individual" },
    { id: 14, Option1_PPT:   80 ,   Option1_Partner:  70 ,  Type1:   "Prosocial" ,  Option2_PPT:  90 ,   Option2_Partner:  60 ,  Type2: "Individual"   },
    { id: 15, Option1_PPT:   90 ,   Option1_Partner:  80 ,  Type1:   "Prosocial" ,  Option2_PPT:  100 ,   Option2_Partner:  70 ,  Type2: "Individual"  },
    { id: 16, Option1_PPT:   70 ,   Option1_Partner:  70 ,  Type1:   "Prosocial" ,  Option2_PPT:  90 ,   Option2_Partner:   60 ,  Type2: "Individual"   },
    { id: 17, Option1_PPT:  100 ,   Option1_Partner:  90 ,  Type1:   "Prosocial" ,  Option2_PPT:  110 ,   Option2_Partner:  80 ,  Type2: "Individual"   },
    { id: 18, Option1_PPT:  100 ,  Option1_Partner: 100  ,  Type1:    "Prosocial",   Option2_PPT:  110  ,    Option2_Partner:  80  ,  Type2:   "Individual" },
    { id: 19, Option1_PPT:   80 ,   Option1_Partner:  80 ,  Type1:   "Prosocial" ,  Option2_PPT:  90 ,   Option2_Partner:  60 ,  Type2: "Individual"   },
    { id: 20, Option1_PPT:   80 ,   Option1_Partner:  80 ,  Type1:   "Prosocial" ,  Option2_PPT:  90 ,   Option2_Partner:  70 ,  Type2: "Individual"  },
    { id: 21, Option1_PPT:   90 ,   Option1_Partner:  90 ,  Type1:   "Prosocial" ,  Option2_PPT:  100 ,   Option2_Partner:  70 ,  Type2: "Individual"  },
    { id: 22, Option1_PPT:  100 ,   Option1_Partner:  90 ,  Type1:   "Prosocial" ,  Option2_PPT:  110 ,   Option2_Partner:  80 ,  Type2: "Individual"  },
    { id: 23, Option1_PPT:  100 ,   Option1_Partner:  100 ,  Type1:   "Prosocial" ,  Option2_PPT:  110 ,   Option2_Partner:  80 ,  Type2: "Individual"   },
    { id: 24, Option1_PPT:   80 ,   Option1_Partner:  70 ,  Type1:   "Prosocial" ,  Option2_PPT:  90 ,   Option2_Partner:  50 ,  Type2: "Individual"   },
    { id: 25, Option1_PPT:   80 ,   Option1_Partner:  80 ,  Type1:   "Prosocial" ,  Option2_PPT:  90 ,   Option2_Partner:  70 ,  Type2: "Individual"   },
    { id: 26, Option1_PPT:   90 ,   Option1_Partner:  90 ,  Type1:   "Prosocial" ,  Option2_PPT:  100 ,   Option2_Partner:  70 ,  Type2: "Individual"  },
    { id: 27, Option1_PPT:   80 ,   Option1_Partner:  80 ,  Type1:   "Prosocial" ,  Option2_PPT:  90 ,   Option2_Partner:  60 ,  Type2: "Individual"   },
    { id: 28, Option1_PPT:   90 ,   Option1_Partner:  80 ,  Type1:   "Prosocial" ,  Option2_PPT:  100 ,   Option2_Partner:  70 ,  Type2: "Individual"   },
    { id: 29, Option1_PPT:   90 ,   Option1_Partner:  90 ,  Type1:   "Prosocial" ,  Option2_PPT:  100 ,   Option2_Partner:  70 ,  Type2: "Individual"   },
    { id: 30, Option1_PPT:   90 ,   Option1_Partner:  80 ,  Type1:   "Prosocial" ,  Option2_PPT:  90 ,   Option2_Partner:  60 ,  Type2: "Individual"   }
];

var currentIndex = 0;
var selectedOption = null;
var selectedOptions = [];
var resultsData_trial2 = [];

var dataTypeSet = false;
let dataType;

var option_trial_Data_selected = [];
var correctOptions = [];
let displayedOptions = [];

var usedIds = new Set(); // مجموعه‌ای برای ذخیره شناسه‌های استفاده شده

function selectOptions() {
if (!dataTypeSet) {
    dataType = localStorage.getItem('dataType');
    localStorage.setItem('dataType', dataType);
    dataTypeSet = true;
}

let primaryType = dataType.charAt(0).toUpperCase() + dataType.slice(1);
let secondaryType = primaryType === 'Individual' ? 'Prosocial' : 'Individual';

let primaryOptions = option_trial_Data.filter(item => 
    (item.Type1 === primaryType || item.Type2 === primaryType) && !usedIds.has(item.id)
);
let secondaryOptions = option_trial_Data.filter(item => 
    (item.Type1 === secondaryType || item.Type2 === secondaryType) && !usedIds.has(item.id)
);

shuffleArray(primaryOptions);
shuffleArray(secondaryOptions);

// انتخاب 9 گزینه اصلی اول
let firstNinePrimaryOptions = [];
for (let item of primaryOptions) {
    if (firstNinePrimaryOptions.length < 9 && !usedIds.has(item.id)) {
        firstNinePrimaryOptions.push({
            ...item,
            correctType: primaryType,
            correctOption: item.Type1 === primaryType ? 'Option1' : 'Option2'
        });
        usedIds.add(item.id);
    }
}

// انتخاب 6 گزینه اصلی اضافی
let additionalPrimaryOptions = [];
for (let item of primaryOptions) {
    if (additionalPrimaryOptions.length < 6 && !usedIds.has(item.id)) {
        additionalPrimaryOptions.push({
            ...item,
            correctType: primaryType,
            correctOption: item.Type1 === primaryType ? 'Option1' : 'Option2'
        });
        usedIds.add(item.id);
    }
}

// انتخاب 15 گزینه ثانویه
let selectedSecondaryOptions = [];
for (let item of secondaryOptions) {
    if (selectedSecondaryOptions.length < 15 && !usedIds.has(item.id)) {
        selectedSecondaryOptions.push({
            ...item,
            correctType: secondaryType,
            correctOption: item.Type1 === secondaryType ? 'Option1' : 'Option2'
        });
        usedIds.add(item.id);
    }
}

// ترکیب گزینه‌های اضافی اصلی و ثانویه و مخلوط کردن آنها
let remainingOptions = [...additionalPrimaryOptions, ...selectedSecondaryOptions];
shuffleArray(remainingOptions);

// ترکیب همه گزینه‌ها، با 9 گزینه اصلی اول در ابتدا
option_trial_Data_selected = [
    ...firstNinePrimaryOptions,
    ...remainingOptions
];

correctOptions = option_trial_Data_selected.map(item => item.correctOption);

console.log("First 9 Primary Options:", firstNinePrimaryOptions.length);
console.log("Remaining Options:", remainingOptions.length);
console.log("All Selected Options:", option_trial_Data_selected);

option_trial_Data_selected.forEach((item, index) => {
    console.log(`Item ${index + 1}: ID = ${item.id}, Correct Option = ${item.correctOption}, Correct Type = ${item.correctType}`);
});

showNextOptions();
}
var totalCount = 30; // Total number of trials
var currentCount = totalCount;
function showNextOptions() {
if (currentIndex >= option_trial_Data_selected.length) {
    console.log("Trial ended");
    localStorage.setItem('resultsData_trial2', JSON.stringify(resultsData_trial2));
    window.location.href = "sur-2.html";
    return;
}
document.getElementById("count-display1").textContent = currentCount;

var currentOption = option_trial_Data_selected[currentIndex];
var tableBody = document.querySelector("#optionsTable_trial1 tbody");
tableBody.innerHTML = "";

// For the first 10 items, randomly decide whether to swap the options
if (currentIndex < 10 && Math.random() < 0.5) {
    // Swap the options
    var tempOption1 = {
        PPT: currentOption.Option1_PPT,
        Partner: currentOption.Option1_Partner,
        Type: currentOption.Type1
    };
    currentOption.Option1_PPT = currentOption.Option2_PPT;
    currentOption.Option1_Partner = currentOption.Option2_Partner;
    currentOption.Type1 = currentOption.Type2;
    currentOption.Option2_PPT = tempOption1.PPT;
    currentOption.Option2_Partner = tempOption1.Partner;
    currentOption.Type2 = tempOption1.Type;

    // Update the correct option
    currentOption.correctOption = currentOption.correctOption === 'Option1' ? 'Option2' : 'Option1';
}

var row1 = createOptionRow(currentOption, 1);
var row2 = createOptionRow(currentOption, 2);

tableBody.innerHTML = row1 + row2;

selectedOption = null;

highlightRows(currentOption.correctOption);

console.log(`Showing item ${currentIndex + 1}:`);
console.log(`Option1: PPT = ${currentOption.Option1_PPT}, Partner = ${currentOption.Option1_Partner}, Type = ${currentOption.Type1}`);
console.log(`Option2: PPT = ${currentOption.Option2_PPT}, Partner = ${currentOption.Option2_Partner}, Type = ${currentOption.Type2}`);
console.log(`Correct Option = ${currentOption.correctOption}`);

}

function createOptionRow(option, optionNumber) {
    return `
        <tr class="option-row">
            <td>
                                    <input style="display:none" type="radio" name="option" value="Option${optionNumber}" onchange="handleOptionChange(this)">
</td>
            <td class="option-cell">
                ${option['Option' + optionNumber + '_PPT']}
            </td>
            <td class="option-cell">${option['Option' + optionNumber + '_Partner']}</td>
        </tr>
    `;
}

function confirmSelection() {
if (!selectedOption) {
    selectedOption = 'Option1';
}

var currentOption = option_trial_Data_selected[currentIndex];
var correctOption = currentOption.correctOption;
var correctType = currentOption[correctOption === 'Option1' ? 'Type1' : 'Type2'];

console.log(`Item ${currentIndex + 1} - Selected: ${selectedOption}, Correct: ${correctOption}`);
console.log(`Selected Type: ${currentOption[selectedOption === 'Option1' ? 'Type1' : 'Type2']}`);

resultsData_trial2.push({
    id: currentOption.id,
    Option1_PPT: currentOption.Option1_PPT,
    Option1_Partner: currentOption.Option1_Partner,
    Option2_PPT: currentOption.Option2_PPT,
    Option2_Partner: currentOption.Option2_Partner,
    Type1: currentOption.Type1,
    Type2: currentOption.Type2,
    Display: "Play-Guess",
    answer: "",
    answer_type: "",
    difference1: Math.abs(currentOption.Option1_PPT - currentOption.Option1_Partner),
    difference2: Math.abs(currentOption.Option2_PPT - currentOption.Option2_Partner),
    dataType: dataType,
    correctType: correctType
});

console.log("Added to resultsData_trial2:", resultsData_trial2[resultsData_trial2.length - 1]);

highlightRows(correctOption);

currentIndex++;
if (currentIndex >= option_trial_Data_selected.length) {
    console.log("Final resultsData_trial2:", resultsData_trial2);
    document.getElementById('confirmButton_trial1').innerText = "اتمام";
    localStorage.setItem('resultsData_trial2', JSON.stringify(resultsData_trial2));
        window.location.href = "sur-2.html";

    
} else {
    setTimeout(showNextOptions, 100);
    currentCount--;
    document.getElementById("count-display1").textContent = currentCount;
}
}

function highlightRows(correctOption) {
var rows = document.querySelectorAll("#optionsTable_trial1 tbody tr");
rows.forEach(row => {
    var input = row.querySelector("input[type='radio']");
    if (input.value === correctOption) {
        row.classList.add('correct');
        row.classList.remove('incorrect');
    } else {
        row.classList.add('incorrect');
        row.classList.remove('correct');
    }
});
}

function shuffleArray(array) {
    for (let i = array.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [array[i], array[j]] = [array[j], array[i]];
    }
}

function handleOptionChange(input) {
    selectedOption = input.value;
}

window.onload = selectOptions;